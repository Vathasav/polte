---
# Build heat stack
- include: playbooks/build-heat-stack.yml

# workaround: Force all nodes to the ".openstacklocal" domain
- include: playbooks/openstacklocal_domain.yml

# Install and configure LDAP server
- include: playbooks/ldap_server.yml

# Bootstrap and puppetize puppetmaster
- include: playbooks/puppetmaster.yml

# workarounds for cccp/newton
- include: playbooks/puppet_environment_mods.yml

# workaround: Force domain again since puppetmaster puppetization touches /etc/hosts
- include: playbooks/openstacklocal_domain.yml

# Puppetize backend nodes
- include: playbooks/puppetize_backends.yml

# Puppetize API nodes
#- include: playbooks/puppetize_apis.yml
- include: playbooks/pre_puppetize_apis.yml
- include: playbooks/puppetize_apis_loop.yml
  with_items:
    - init
    - cluster-formation
    - openstack-cli-gets-added-after-this
    - 1st-run-with-accept-selfsigned
    - 1st-run-with-admin-for-service-project
    - final
- include: playbooks/post_puppetize_apis.yml
